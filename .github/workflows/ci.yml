name: CMake Build

on:
  push:
    branches: [ main ]

jobs:
  build:
    runs-on: ubuntu-latest
    env:
      BUILD_DIR: build

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Install system dependencies
        run: |
          sudo apt-get update
          # build-essential for compilers, cmake for config, libssl-dev for OpenSSL
          sudo apt-get install -y build-essential cmake libssl-dev

      - name: Configure CMake
        run: |
          cmake -S . -B $BUILD_DIR -DCMAKE_BUILD_TYPE=Release

      - name: Build
        run: |
          cmake --build $BUILD_DIR --config Release -- -j

      - name: List build artifacts (for debugging)
        run: ls -la $BUILD_DIR

      # Tests are not implemented yet â€” kept commented. Uncomment when you add tests.
      # - name: Run tests
      #   run: |
      #     cmake --build $BUILD_DIR --target test
      #     ctest --test-dir $BUILD_DIR --output-on-failure
